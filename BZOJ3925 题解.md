# BZOJ3925 题解

## 题意

给一张无向图，图中的每一条边的权值是一个在[0,1]范围随机分布的变量；求这张图最小瓶颈树的最大权的期望值。

## 思路

考虑最后的答案的形式：

$$
\mathrm{E}X = \sum_{\omega\in\Omega}Pr(\omega)X(\omega)
$$
其中，$Pr(\omega)$表示原图的某一个确定权图出现的概率，$X(\omega)$ 表示这张图的瓶颈树的最大权值；然而这个式子还不是“离散”的形式。主要原因在于图的权值的分布是连续的；于是，我们考虑离散状态下的情况，即给出各边的排名，来表示出$\mathrm{E}X$ ；

还记得原题中给了一个公式，即：n个在[0,1]随机分布的变量中，第k大的期望值为$\frac{k}{(n+1)}$ 。

那么我们把每个最大边权为第k大的事件合并起来则原式可以表示为：
$$
\mathrm{E}X=\frac{\sum_{k=1}^mkPr(K=k)}{n+1}
$$
$Pr(K=k)$表示$\frac{k}{(n+1)}$贡献的概率，即最小生成树最大边权排名第k的概率。

我们考虑$\sum_{k=1}^mkPr(K=k)$的如何计算：这里我们的Pr其实表示的是，第k条边是 **在按每一种顺序添加边时，第一个让图连通的边** 的概率。直接计算原式不方便，但是直接计算图连通方案，不连通方案等问题却要好做得多；

观察原式：其中k倍 Pr( K = k ) 可以看做 Pr( K = k ) 被重复k次；即我们要求下面矩阵的每一项的和：
$$
\begin{bmatrix}
Pr(K=1)&Pr(K=2)&\cdots&Pr(K=k)\\
&Pr(K=2)&\cdots&Pr(K=k)\\
&&\ddots&\vdots\\
&&&Pr(K=k)\\
\end{bmatrix}
$$
原来我们是分开别算每数列的和，其实我们也可以考虑一行一行的算，即原式也等于：
$$
\sum_{k=1}^mPr(K\ge k)
$$
其中$Pr(K\ge k)$表示最大边排名大于等于k的概率；那么$K\ge k$的条件怎么处理呢？如果第一次连通添加的边大于等于k，那么第k-1次添加边的时候，图一定不连通。同理，任何一个添加排名k-1的边时不连通的方案，它第一个连通的时刻一定大于等于k；所以这两种事件完全等价。

于是我们要求的变成了求添加排名第$1\cdots m$条边时图不连通的概率。

为了计算不连通的概率，我们需要计算添加第k条边时不连通的方案，并除以所有添加k条边的情况。虽然原意要考虑添加顺序，但是实际上不考虑顺序的方案都要乘一个阶乘才能变成考虑顺序的方案，所以分子分母的阶乘可以直接抵消。

后者很简单，等于$\binom{m}{k}$ ；

前者我们尝试用动态规划的方法计数：既然我们考虑的是图不连通的方案，那我们看不连通时图的形态，一定是若干连通块拼接而成。考虑一个联通子块，我们尝试枚举这个联通子块，那么剩下的边都是可以随便连接的。**为了防止算重，我们可以确保联通子块始终包含一个确定点。**

根据上面的分析，我们考虑设立状态$f[s][i]$表示点集s中连了i条边，点集内不连通的方案数。因为我们要枚举连通的子集，所以我们考虑再设立一个和$f$互补的状态$g[s][i]$表示点集s中选了i条边，点集内连通的方案数。

这两个互补的状态的关系我们也可以表示出来
$$
\binom{|E(s)|}{i}=f[s][i]+g[s][i]
$$
那么枚举s时，计算出了$f[s][i]$，就可以同时计算出对应的$g[s][i]$来为后面的状态s'的计算提供信息；

接下来我们来看$f[s][i]$的转移方程怎么写（接下来的计算就是NOIP难度了）：
$$
f[s][i] = \sum_{s'\subset s,p\in s \&p\in s',j\le i}g[s'][j]\binom{|E(s-s')|}{i-j}
$$
其中p是任意一个属于s集合的一个点，也就是上面我们避免算重取出来的一个确定点。

最后的答案也可以表示出来：
$$
\mathrm{E}X=\frac{1}{m+1}\sum_{i=0}^{n-1}\frac{f[S][i]}{\binom{m}{i}}
$$
